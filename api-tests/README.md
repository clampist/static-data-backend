# APIæµ‹è¯•è„šæœ¬ç›®å½•

è¿™ä¸ªç›®å½•åŒ…å«äº†APIæ¥å£æµ‹è¯•ç›¸å…³çš„è„šæœ¬ï¼Œç”¨äºæµ‹è¯•åç«¯æœåŠ¡çš„å„ç§APIæ¥å£ã€‚

## è„šæœ¬è¯´æ˜

### æ ¸å¿ƒè„šæœ¬

- **api-coverage-test.sh** - APIè¦†ç›–ç‡æµ‹è¯•ä¸»è„šæœ¬ ğŸ¯
  - ä½¿ç”¨JaCoCo Agentæ¨¡å¼å¯åŠ¨ç›®æ ‡ç¨‹åº
  - è¿è¡Œå®Œæ•´çš„APIæ¥å£æµ‹è¯•å¥—ä»¶
  - åœæ­¢åº”ç”¨å¹¶dumpè¦†ç›–ç‡æ•°æ®
  - å°†jacoco.execæ–‡ä»¶å¤åˆ¶åˆ°api-tests/covç›®å½•

- **quick-api-coverage.sh** - å¿«é€ŸAPIæµ‹è¯•è„šæœ¬ âš¡
  - ä»…è´Ÿè´£è°ƒç”¨APIæ¥å£æµ‹è¯•
  - ä¸æ¶‰åŠä»»ä½•è¦†ç›–ç‡ç›¸å…³æ“ä½œ
  - å¿«é€ŸéªŒè¯APIåŠŸèƒ½

- **generate-report-standalone.sh** - ç‹¬ç«‹è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆå™¨ ğŸ“Š
  - å¤åˆ¶ä¾èµ–çš„æºç åŒ…å’ŒclassåŒ…åˆ°api-tests/covç›®å½•
  - è§£å‹é¢„ç¼–è¯‘åŒ…
  - ä½¿ç”¨jacococli.jarç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
  - ç”ŸæˆHTMLã€CSVã€XMLæ ¼å¼æŠ¥å‘Š

### å·¥å…·è„šæœ¬

- **setup-jacoco-agent.sh** - JaCoCo Agentè®¾ç½®è„šæœ¬
  - ä¸‹è½½å¹¶å®‰è£…JaCoCo Agentå’ŒCLIå·¥å…·
  - é…ç½®å¿…è¦çš„JaCoCoç»„ä»¶

### APIæµ‹è¯•è„šæœ¬

- **test-auth-apis.sh** - è®¤è¯APIæµ‹è¯•
  - æµ‹è¯•ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€tokenéªŒè¯ç­‰åŠŸèƒ½
  - éªŒè¯è®¤è¯æµç¨‹çš„å®Œæ•´æ€§

- **test-organization-apis.sh** - ç»„ç»‡ç®¡ç†APIæµ‹è¯•
  - æµ‹è¯•ç»„ç»‡åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œ
  - éªŒè¯ç»„ç»‡å±‚çº§å…³ç³»ç®¡ç†

- **test-final-datafile.sh** - æ•°æ®æ–‡ä»¶APIæµ‹è¯•
  - æµ‹è¯•æ•°æ®æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢ç­‰åŠŸèƒ½
  - éªŒè¯æ•°æ®æ–‡ä»¶ç®¡ç†æµç¨‹

- **test-datafile-query-fix.sh** - æ•°æ®æ–‡ä»¶æŸ¥è¯¢ä¿®å¤éªŒè¯
  - ä¸“é—¨éªŒè¯PostgreSQL byteaé—®é¢˜çš„ä¿®å¤
  - ç¡®ä¿æ•°æ®æ–‡ä»¶æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸

## ä½¿ç”¨æ–¹æ³•

### å®Œæ•´APIè¦†ç›–ç‡æµ‹è¯•æµç¨‹

```bash
# 1. è¿è¡ŒAPIè¦†ç›–ç‡æµ‹è¯•ï¼ˆAgentæ¨¡å¼ï¼‰
./api-coverage-test.sh

# 2. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./generate-report-standalone.sh
```

### å¿«é€ŸAPIæµ‹è¯•

```bash
# ä»…è¿è¡ŒAPIæµ‹è¯•ï¼Œä¸æ¶‰åŠè¦†ç›–ç‡
./quick-api-coverage.sh
```

### å•ç‹¬è¿è¡ŒAPIæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šAPIæµ‹è¯•
./test-auth-apis.sh
./test-organization-apis.sh
./test-final-datafile.sh
./test-datafile-query-fix.sh
```

## è„šæœ¬èŒè´£åˆ†å·¥

### api-coverage-test.sh
- âœ… ä½¿ç”¨JaCoCo Agentå¯åŠ¨ç›®æ ‡ç¨‹åº
- âœ… è¿è¡Œå®Œæ•´çš„APIæµ‹è¯•å¥—ä»¶
- âœ… åœæ­¢åº”ç”¨å¹¶dumpè¦†ç›–ç‡æ•°æ®
- âœ… å¤åˆ¶jacoco.execåˆ°api-tests/covç›®å½•

### quick-api-coverage.sh
- âœ… ä»…è´Ÿè´£è°ƒç”¨APIæ¥å£
- âœ… ä¸æ¶‰åŠè¦†ç›–ç‡ç›¸å…³æ“ä½œ
- âœ… å¿«é€ŸéªŒè¯APIåŠŸèƒ½

### generate-report-standalone.sh
- âœ… å¤åˆ¶é¢„ç¼–è¯‘åŒ…åˆ°api-tests/covç›®å½•
- âœ… è§£å‹æºç åŒ…å’ŒclassåŒ…
- âœ… ä½¿ç”¨jacococli.jarç”ŸæˆæŠ¥å‘Š
- âœ… ç”ŸæˆHTMLã€CSVã€XMLæŠ¥å‘Š

### APIæµ‹è¯•è„šæœ¬
- âœ… åªè´Ÿè´£è°ƒç”¨APIæ¥å£
- âœ… éªŒè¯APIå“åº”å’ŒåŠŸèƒ½
- âœ… ä¸æ¶‰åŠè¦†ç›–ç‡æ“ä½œ

## ç›®å½•ç»“æ„

```
api-tests/
â”œâ”€â”€ api-coverage-test.sh          # ä¸»è¦†ç›–ç‡æµ‹è¯•è„šæœ¬
â”œâ”€â”€ quick-api-coverage.sh         # å¿«é€ŸAPIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ generate-report-standalone.sh # ç‹¬ç«‹æŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ setup-jacoco-agent.sh         # JaCoCo Agentè®¾ç½®
â”œâ”€â”€ test-auth-apis.sh             # è®¤è¯APIæµ‹è¯•
â”œâ”€â”€ test-organization-apis.sh     # ç»„ç»‡ç®¡ç†APIæµ‹è¯•
â”œâ”€â”€ test-final-datafile.sh        # æ•°æ®æ–‡ä»¶APIæµ‹è¯•
â”œâ”€â”€ test-datafile-query-fix.sh    # æ•°æ®æ–‡ä»¶æŸ¥è¯¢ä¿®å¤éªŒè¯
â”œâ”€â”€ jacoco/                       # JaCoCoå·¥å…·ç›®å½•
â”‚   â”œâ”€â”€ jacocoagent.jar          # JaCoCo Agent
â”‚   â””â”€â”€ jacococli.jar            # JaCoCo CLI
â””â”€â”€ cov/                         # è¦†ç›–ç‡æ•°æ®ç›®å½•
    â”œâ”€â”€ jacoco.exec              # JaCoCoæ‰§è¡Œæ•°æ®
    â”œâ”€â”€ compiled-artifacts_*.tar.gz  # ç¼–è¯‘äº§ç‰©åŒ…
    â”œâ”€â”€ source-code_*.tar.gz     # æºç åŒ…
    â””â”€â”€ reports/                 # æŠ¥å‘Šç›®å½•
        â”œâ”€â”€ latest/              # æœ€æ–°æŠ¥å‘Š
        â””â”€â”€ report_YYYYMMDD_HHMMSS/  # å†å²æŠ¥å‘Š
```

## å‰ç½®æ¡ä»¶

1. **Javaç¯å¢ƒ**: ç¡®ä¿Java 8+å·²å®‰è£…
2. **Mavenç¯å¢ƒ**: ç¡®ä¿Mavenå·²å®‰è£…
3. **JaCoCoå·¥å…·**: è¿è¡Œ`./setup-jacoco-agent.sh`å®‰è£…JaCoCoå·¥å…·
4. **é¢„ç¼–è¯‘åŒ…**: ç¡®ä¿å­˜åœ¨é¢„ç¼–è¯‘åŒ…æ–‡ä»¶ï¼ˆåœ¨`../ut-scripts/packages/`ç›®å½•ï¼‰

## æµ‹è¯•ç”¨æˆ·å‡­æ®

- ç”¨æˆ·å: `testuser` æˆ– `admin`
- å¯†ç : `password123` æˆ– `admin123`

## æŠ¥å‘ŠæŸ¥çœ‹

- **æœ€æ–°æŠ¥å‘Š**: `api-tests/cov/reports/latest/index.html`
- **å†å²å¤‡ä»½**: `api-tests/cov/reports/report_YYYYMMDD_HHMMSS/index.html`
- **Jacocoæ•°æ®**: `api-tests/cov/jacoco.exec`

## æ•…éšœæ’é™¤

### åº”ç”¨å¯åŠ¨å¤±è´¥
å¦‚æœåº”ç”¨å¯åŠ¨å¤±è´¥ï¼ˆå¦‚ç¼–è¯‘é”™è¯¯ï¼‰ï¼Œå¯ä»¥ï¼š
1. æ£€æŸ¥é¡¹ç›®ç¼–è¯‘çŠ¶æ€
2. ä¿®å¤ç¼–è¯‘é”™è¯¯
3. é‡æ–°è¿è¡Œ`./api-coverage-test.sh`

### ç¼ºå°‘é¢„ç¼–è¯‘åŒ…
å¦‚æœç¼ºå°‘é¢„ç¼–è¯‘åŒ…ï¼š
1. ç¡®ä¿åœ¨`../ut-scripts/packages/`ç›®å½•å­˜åœ¨åŒ…æ–‡ä»¶
2. åŒ…æ–‡ä»¶å‘½åæ ¼å¼ï¼š`compiled-artifacts_YYYYMMDD_HHMMSS.tar.gz`å’Œ`source-code_YYYYMMDD_HHMMSS.tar.gz`

### JaCoCoå·¥å…·ç¼ºå¤±
å¦‚æœJaCoCoå·¥å…·ç¼ºå¤±ï¼š
1. è¿è¡Œ`./setup-jacoco-agent.sh`å®‰è£…å·¥å…·
2. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆéœ€è¦ä¸‹è½½å·¥å…·ï¼‰

## æ³¨æ„äº‹é¡¹

1. **è„šæœ¬è§£è€¦**: å„è„šæœ¬èŒè´£æ˜ç¡®ï¼Œç›¸äº’ç‹¬ç«‹
2. **æ•°æ®ç®¡ç†**: æ‰€æœ‰è¦†ç›–ç‡æ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`api-tests/cov`ç›®å½•
3. **æŠ¥å‘Šç”Ÿæˆ**: ä½¿ç”¨é¢„ç¼–è¯‘åŒ…ç¡®ä¿æŠ¥å‘Šä¸€è‡´æ€§
4. **é”™è¯¯å¤„ç†**: å„è„šæœ¬åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯